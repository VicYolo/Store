<!doctype html>
<html>

<head>
	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>会员登录</title>
	<link rel="stylesheet" href="./css/bootstrap.min.css" type="text/css" />
	<script src="./js/jquery-1.11.3.min.js" type="text/javascript"></script>
	<script src="./js/bootstrap.min.js" type="text/javascript"></script>
	<!-- 引入自定义css文件 style.css -->
	<link rel="stylesheet" href="./css/style.css" type="text/css" />
	<script type="text/javascript" src="js/include.js"></script>
	<script type="text/javascript" src="js/getParameter.js"></script>
	<style>
		body {
			margin-top: 20px;
			margin: 0 auto;
		}

		.carousel-inner .item img {
			width: 100%;
			height: 300px;
		}
	</style>
</head>
<script>
	$(function (){
		// 展示此次订单数据
		$.get("order/showCurOrder",{},function(res){
			if(null!=res) {
				showOrder(res)
			}
		})
		var oid = getParameter("oid")
		$.get("order/getOrderByOid",{oid:oid},function (res){
			console.log(oid+".....前台")

			showOrder(res)
		})
	})
	function showOrder(res){
		// 将订单结果展示到前端
		console.log(res)
		h_lis = '<strong>订单详情</strong>\n' +
				'\t\t\t\t<table class="table table-bordered">\n' +
				'\t\t\t\t\t<tbody>\n' +
				'\t\t\t\t\t\t<tr class="warning">\n' +
				'\t\t\t\t\t\t\t<th colspan="5">订单编号:'+res.oid+'</th>\n' +
				'\t\t\t\t\t\t</tr>\n' +
				'\t\t\t\t\t\t<tr class="warning">\n' +
				'\t\t\t\t\t\t\t<th>图片</th>\n' +
				'\t\t\t\t\t\t\t<th>商品</th>\n' +
				'\t\t\t\t\t\t\t<th>价格</th>\n' +
				'\t\t\t\t\t\t\t<th>数量</th>\n' +
				'\t\t\t\t\t\t\t<th>小计</th>\n' +
				'\t\t\t\t\t\t</tr>'
		lis = ''
		lis+=h_lis
		for(var i=0;i< res.items.length;i++){
			var goods = res.items[i]
			li = '<tr class="active">\n' +
					'\t\t\t\t\t\t\t<td width="60" width="40%">\n' +
					'\t\t\t\t\t\t\t\t<input type="hidden" name="id" value="22">\n' +
					'\t\t\t\t\t\t\t\t<img src="'+goods.product.pimage+'" width="70" height="60">\n' +
					'\t\t\t\t\t\t\t</td>\n' +
					'\t\t\t\t\t\t\t<td width="30%">\n' +
					'\t\t\t\t\t\t\t\t<a target="_blank">'+goods.product.pname+'</a>\n' +
					'\t\t\t\t\t\t\t</td>\n' +
					'\t\t\t\t\t\t\t<td width="20%">\n' +
					'\t\t\t\t\t\t\t\t￥'+goods.product.shop_price+'\n' +
					'\t\t\t\t\t\t\t</td>\n' +
					'\t\t\t\t\t\t\t<td width="10%">\n' +
					'\t\t\t\t\t\t\t\t'+goods.count+'\n' +
					'\t\t\t\t\t\t\t</td>\n' +
					'\t\t\t\t\t\t\t<td width="15%">\n' +
					'\t\t\t\t\t\t\t\t<span class="subtotal">￥'+goods.subtotal+'</span>\n' +
					'\t\t\t\t\t\t\t</td>\n' +
					'\t\t\t\t\t\t</tr>'
			lis+=li
		}
		lis+='\t</tbody>\n' +
				'\t\t\t\t</table>'
		$("#order_detail").html(lis)
		$("#total_price").html('商品金额: <strong style="color:#ff6600;">￥'+res.total+'元</strong>')
	}

	function payForOrder(){
		var address = $("#address").val()
		var nname = $("#nname").val()
		var phone = $("#phone").val()

		var addressTest = address==""?false:true
		var nameTest = nname==""?false:true
		var phoneTest = phone==""?false:true
		var test = addressTest&&nameTest&&phoneTest
		if(test){
			alert("你已成功支付")
			var orderState = 1
			var oid = getParameter("oid")
			$.post("order/changeOrderStatus",{oid:oid,orderState:orderState,address:address,name:nname,telephone:phone});
			location.href = "order_list.html"
		}else{
			alert("请填写相关信息")
		}

	}

</script>
<body>
	<div id="header"></div>
	<div class="container">
		<div class="row">

			<div style="margin:0 auto;margin-top:10px;width:950px;" id = "order_detail">
				<strong>订单详情</strong>
				<table class="table table-bordered">
					<tbody>
						<tr class="warning">
							<th colspan="5">订单编号:9005 </th>
						</tr>
						<tr class="warning">
							<th>图片</th>
							<th>商品</th>
							<th>价格</th>
							<th>数量</th>
							<th>小计</th>
						</tr>
						<tr class="active">
							<td width="60" width="40%">
								<input type="hidden" name="id" value="22">
								<img src="./image/dadonggua.jpg" width="70" height="60">
							</td>
							<td width="30%">
								<a target="_blank"> 有机蔬菜 大冬瓜...</a>
							</td>
							<td width="20%">
								￥298.00
							</td>
							<td width="10%">
								5
							</td>
							<td width="15%">
								<span class="subtotal">￥596.00</span>
							</td>
						</tr>
					</tbody>
				</table>
			</div>

			<div style="text-align:right;margin-right:120px;" id = "total_price">
				商品金额: <strong style="color:#ff6600;">￥596.00元</strong>
			</div>

		</div>

		<div>
			<hr />
			<form class="form-horizontal" style="margin-top:5px;margin-left:150px;">
				<div class="form-group">
					<label for="address" class="col-sm-1 control-label">地址</label>
					<div class="col-sm-5">
						<input type="text" class="form-control" id="address" placeholder="请输入收货地址">
					</div>
				</div>
				<div class="form-group">
					<label for="nname" class="col-sm-1 control-label">收货人</label>
					<div class="col-sm-5">
						<input type="text" class="form-control" id="nname" placeholder="请输收货人">
					</div>
				</div>
				<div class="form-group">
					<label for="phone" class="col-sm-1 control-label">电话</label>
					<div class="col-sm-5">
						<input type="text" class="form-control" id="phone" placeholder="请输入联系方式">
					</div>
				</div>
			</form>
			<hr />
			<div style="margin-top:5px;margin-left:150px;">
				<strong>选择银行：</strong>
				<p>
					<br />
					<input type="radio" name="pd_FrpId" value="ICBC-NET-B2C" checked="checked" />工商银行
					<img src="./bank_img/icbc.bmp" align="middle" />&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="pd_FrpId" value="BOC-NET-B2C" />中国银行
					<img src="./bank_img/bc.bmp" align="middle" />&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="pd_FrpId" value="ABC-NET-B2C" />农业银行
					<img src="./bank_img/abc.bmp" align="middle" />
					<br />
					<br />
					<input type="radio" name="pd_FrpId" value="BOCO-NET-B2C" />南京银行
					<img src="./bank_img/nanjing.bmp" align="middle" />&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="pd_FrpId" value="PINGANBANK-NET" />平安银行
					<img src="./bank_img/pingan.bmp" align="middle" />&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="pd_FrpId" value="CCB-NET-B2C" />建设银行
					<img src="./bank_img/ccb.bmp" align="middle" />
					<br />
					<br />
					<input type="radio" name="pd_FrpId" value="CEB-NET-B2C" />光大银行
					<img src="./bank_img/guangda.bmp" align="middle" />&nbsp;&nbsp;&nbsp;&nbsp;
					<input type="radio" name="pd_FrpId" value="CMBCHINA-NET-B2C" />招商银行
					<img src="./bank_img/cmb.bmp" align="middle" />

				</p>
				<hr />
				<p style="text-align:right;margin-right:100px;">
					<a href="#" onclick="payForOrder()">
						<img src="./images/finalbutton.gif" width="204" height="51" border="0" />
					</a>
				</p>
				<hr />

			</div>
		</div>

	</div>
	<div id="footer"></div>

</body>

</html>